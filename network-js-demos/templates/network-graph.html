<!-- Network Graph Component Template -->
<style>
    #network-graph-container {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.5) 0%, rgba(249, 250, 251, 0.5) 100%);
        position: relative;
    }

    .dark #network-graph-container {
        background: linear-gradient(135deg, rgba(26, 26, 46, 0.7) 0%, rgba(22, 33, 62, 0.7) 100%);
    }

    #network-graph-container svg {
        background: transparent;
    }
</style>

<!-- Split Layout -->
<div class="flex flex-col lg:flex-row h-screen" x-init="if (!_initialized) { $nextTick(() => initializeGraph()) }">
    <!-- Left Panel: Info & Controls -->
    <div class="lg:w-1/3 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-r border-gray-200/50 dark:border-gray-700/50 overflow-y-auto p-6 space-y-6">
        <!-- Header -->
        <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2">
                ğŸ•¸ï¸ Interactive Network Graph
            </h1>
            <p class="text-gray-600 dark:text-gray-400">
                Explore network analysis in real-time. Add nodes, remove them, and watch the centrality metrics update dynamically.
            </p>
        </div>

        <!-- What is this? -->
        <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4">
            <h2 class="text-lg font-semibold text-blue-900 dark:text-blue-300 mb-2">What is this?</h2>
            <p class="text-sm text-blue-800 dark:text-blue-200">
                This interactive visualization demonstrates <strong>eigenvector centrality</strong> -
                a measure of influence in a network. Node size represents importance: larger nodes
                are more influential because they're connected to other influential nodes.
            </p>
        </div>

        <!-- Controls -->
        <div class="space-y-3">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Controls</h2>

            <button
                @click="addRandomNode()"
                class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-semibold transition-colors shadow-sm"
            >
                â• Add Random Node
            </button>

            <button
                @click="addSpecificNode()"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-semibold transition-colors shadow-sm"
            >
                ğŸ”— Add Node to "Alice"
            </button>

            <button
                @click="removeRandomNode()"
                class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded-lg font-semibold transition-colors shadow-sm"
            >
                â– Remove Random Node
            </button>
        </div>

        <!-- Data Loading -->
        <div class="space-y-3 border-t border-gray-200 dark:border-gray-700 pt-4">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Load Data</h2>

            <div class="space-y-2">
                <label for="data-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                    Choose Dataset:
                </label>
                <select
                    x-model="selectedDataset"
                    class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 px-3 py-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                    <option value="default">Default (Simple)</option>
                    <option value="karate-json">Karate Club - JSON (34 nodes)</option>
                    <option value="karate-csv">Karate Club - CSV (34 nodes)</option>
                    <option value="miserables">Les MisÃ©rables - CSV (77 nodes)</option>
                </select>
            </div>

            <button
                @click="loadData()"
                :disabled="isLoading"
                class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-4 py-3 rounded-lg font-semibold transition-colors shadow-sm"
            >
                <span x-show="!isLoading">ğŸ“Š Load Dataset</span>
                <span x-show="isLoading">â³ Loading...</span>
            </button>
        </div>

        <!-- Layout Controls -->
        <div class="space-y-3 border-t border-gray-200 dark:border-gray-700 pt-4">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Layout Algorithm</h2>

            <div class="space-y-2">
                <label for="layout-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                    Choose Layout:
                </label>
                <select
                    x-model="selectedLayout"
                    class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 px-3 py-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                    <template x-for="layout in availableLayouts" :key="layout.id">
                        <option :value="layout.id" x-text="layout.name"></option>
                    </template>
                </select>
            </div>

            <button
                @click="applyLayoutAlgorithm()"
                class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-semibold transition-colors shadow-sm"
            >
                ğŸ¯ Apply Layout
            </button>

            <div class="bg-yellow-50 dark:bg-yellow-900/30 rounded-lg p-3">
                <p class="text-xs text-yellow-800 dark:text-yellow-200">
                    <template x-for="layout in availableLayouts" :key="layout.id">
                        <div>
                            <strong x-text="`${layout.name}:`"></strong>
                            <span x-text="layout.description"></span>
                            <span x-show="layout.requiresStats" class="italic"> (requires analysis)</span>
                            <br>
                        </div>
                    </template>
                </p>
            </div>
        </div>

        <!-- Node Info (Alpine-powered reactive display) -->
        <div id="node-info-container" class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4">
            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Node Information</h3>
            <div class="text-sm">
                <!-- Default state -->
                <template x-if="nodeInfo.type === 'default'">
                    <div class="text-gray-600 dark:text-gray-400" x-text="nodeInfo.message"></div>
                </template>

                <!-- Loading state -->
                <template x-if="nodeInfo.type === 'loading'">
                    <div class="space-y-1">
                        <div class="text-blue-600 dark:text-blue-400"><strong>â³ Loading...</strong></div>
                        <div class="text-sm text-gray-600 dark:text-gray-400" x-text="nodeInfo.message"></div>
                    </div>
                </template>

                <!-- Success state (dataset loaded) -->
                <template x-if="nodeInfo.type === 'success'">
                    <div class="space-y-1">
                        <div class="text-green-600 dark:text-green-400"><strong>âœ“</strong> <span x-text="nodeInfo.message"></span></div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            <span x-text="nodeInfo.details?.nodes"></span> nodes, <span x-text="nodeInfo.details?.edges"></span> edges
                        </div>
                        <div x-show="nodeInfo.details?.communities" class="text-xs text-purple-600 dark:text-purple-400 mt-2">
                            ğŸ¨ Detected <span x-text="nodeInfo.details?.communities"></span> communities
                        </div>
                        <div x-show="nodeInfo.details?.description" class="text-xs text-gray-500 dark:text-gray-400 mt-2" x-text="nodeInfo.details?.description"></div>
                    </div>
                </template>

                <!-- Error state -->
                <template x-if="nodeInfo.type === 'error'">
                    <div class="text-red-600 dark:text-red-400">
                        <strong>âŒ</strong> <span x-text="nodeInfo.message"></span>
                    </div>
                </template>

                <!-- Node added -->
                <template x-if="nodeInfo.type === 'node-added'">
                    <div>
                        <p class="text-green-600 dark:text-green-400 font-semibold">âœ… <span x-text="nodeInfo.message"></span></p>
                        <p class="mt-2"><strong>ID:</strong> <span x-text="nodeInfo.details?.nodeId"></span></p>
                        <p><strong>Connected to:</strong> <span x-text="nodeInfo.details?.connectedTo"></span></p>
                        <p class="text-xs mt-2 text-gray-500">The graph will re-layout automatically</p>
                    </div>
                </template>

                <!-- Node removed -->
                <template x-if="nodeInfo.type === 'node-removed'">
                    <div>
                        <p class="text-orange-600 dark:text-orange-400 font-semibold">ğŸ—‘ï¸ <span x-text="nodeInfo.message"></span></p>
                        <p class="mt-2"><strong>ID:</strong> <span x-text="nodeInfo.details?.nodeId"></span></p>
                        <p class="text-xs mt-2 text-gray-500">Connected edges were also removed</p>
                    </div>
                </template>

                <!-- Layout applied -->
                <template x-if="nodeInfo.type === 'layout-applied'">
                    <div class="space-y-1">
                        <div class="text-green-600 dark:text-green-400"><strong>âœ“</strong> <span x-text="nodeInfo.message"></span></div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-2" x-text="nodeInfo.details?.description"></div>
                    </div>
                </template>

                <!-- Node hover (live node info) -->
                <template x-if="nodeInfo.type === 'node-hover'">
                    <div class="space-y-1">
                        <div class="text-blue-600 dark:text-blue-400 font-semibold">
                            ğŸ”µ <span x-text="nodeInfo.details?.id"></span>
                        </div>
                        <div class="text-sm text-gray-700 dark:text-gray-300 space-y-0.5">
                            <p><strong>Group:</strong> <span x-text="nodeInfo.details?.group"></span></p>
                            <p><strong>Centrality:</strong> <span x-text="nodeInfo.details?.centrality"></span></p>
                            <p><strong>Degree:</strong> <span x-text="nodeInfo.details?.degree"></span></p>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-purple-50 dark:bg-purple-900/30 rounded-lg p-4">
            <h3 class="text-sm font-semibold text-purple-900 dark:text-purple-300 mb-2">ğŸ’¡ How to interact</h3>
            <ul class="text-sm text-purple-800 dark:text-purple-200 space-y-1">
                <li>ğŸ–±ï¸ <strong>Drag nodes</strong> to reposition them</li>
                <li>ğŸ” <strong>Scroll</strong> to zoom in/out</li>
                <li>ğŸ‘† <strong>Drag background</strong> to pan</li>
                <li>ğŸ“Š <strong>Node size</strong> = eigenvector centrality</li>
                <li>ğŸ¨ <strong>Color</strong> = community group</li>
            </ul>
        </div>

        <!-- Metrics Explanation -->
        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-2">ğŸ“ˆ About Eigenvector Centrality</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
                Unlike degree centrality (which just counts connections), eigenvector centrality
                measures <em>quality</em> of connections.
            </p>
            <p class="text-sm text-gray-600 dark:text-gray-400">
                Think of it like Google's PageRank: it's not just who you know, but
                <strong>who they know</strong>.
            </p>
        </div>
    </div>

    <!-- Right Panel: Graph Visualization -->
    <div class="lg:w-2/3 relative" id="network-graph-container">
        <!-- Loading Indicator -->
        <div id="graph-loading" class="absolute inset-0 flex items-center justify-center bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm z-50" style="display: none;">
            <div class="text-center">
                <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-green-600 border-t-transparent mb-4"></div>
                <p class="text-lg font-semibold text-gray-900 dark:text-gray-100">Calculating graph layout...</p>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">This may take a few seconds for large networks</p>
            </div>
        </div>
        <!-- Graph will be rendered here by D3 -->
    </div>
</div>
